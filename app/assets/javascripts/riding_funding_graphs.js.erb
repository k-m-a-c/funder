$(document).on('page:load', function() {
  $(document).trigger('ready');

  var charts = $(".fundingGraph");
  var ids = [].map.call(charts, function(obj) {
   return $(obj).data().id;
  });
  var transferPayments = $('.card-transfer-payment > .circle');

  for(i=0;i<ids.length;i++) {

    $.getJSON(
      "/organizations/" + ids[i] + "/funding_data",
      function(json) {
        console.log("getJSON callback:");
        console.dir(json);
        var data = assignGraphColors(json);
        createGraphKey();
        var options = {
          responsive: false,
          showTooltips: false
        }
        // Get context with jQuery - using jQuery's .get() method.
        var ctx = $(".fundingGraph").eq(i).get(0).getContext("2d");
        // This will get the first returned node in the jQuery collection.
        var fundingGraph = new Chart(ctx).Doughnut(data, options);

      }
    );
  }

  var colors = [
    {
      color: "#FF5D5D",
      highlight: "#FF8383"
    },
    {
      color: "#52DF52",
      highlight: "#78EB78"
    },
    {
      color: "#5975CB",
      highlight: "#7E96DE"
    },
    {
      color: "#FFCC5D",
      highlight: "#FFD883"
    },
    {
      color: "#FFA75D",
      highlight: "#FFBB83"
    },
    {
      color: "#46BFBF",
      highlight: "#6ED6D6"
    },
    {
      color: "#FFE35D",
      highlight: "#FFEA83"
    },
    {
      color: "#755ACD",
      highlight: "#967FDF"
    },
    {
      color: "#E052A0",
      highlight: "#EB79B7"
    },
    {
      color: "#BFF459",
      highlight: "#CEF875"
    },
    {
      color: "#9551CA",
      highlight: "#B977DD"
    },
    {
      color: "#FFFD5D",
      highlight: "#FFFD83"
    }
  ]

  var assignGraphColors = function(data) {
    for(j=0; j<data.length; j++) {
      data[j].color = colors[j].color;
      data[j].highlight = colors[j].highlight;
      data
    }
    return data;
  }

  var createGraphKey = function() {
    for(j=0;j<transferPayments.length;j++) {
     $(transferPayments[j]).css( "background-color", colors[j].color);
    }
  }
});